<section class="page-header">
  <div>
    <h2 class="page-title">Property Search</h2>
    <p class="page-subtitle">Enter a UK postcode to find Energy Performance Certificates.</p>
  </div>
  <div class="page-actions">
    <form class="search-form" style="display: flex; gap: 10px;">
      <input type="text" id="postcode-input" class="input" placeholder="e.g. OX26 1ET" required 
        style="padding: 8px 12px; border-radius: 8px; border: 1px solid var(--border); background: var(--panel); color: var(--text); width: 200px;">
      <button type="submit" class="btn btn--primary">Search</button>
    </form>
  </div>
</section>

<section class="card">
  <div class="card__header">
    <h3 class="card__title">Saved Properties</h3>
    <span class="badge">{{favorites.length}} saved</span>
  </div>

  <div class="list" id="favorites-list">
    {{#each favorites}}
      <div class="list__row" style="flex-direction: column; align-items: stretch; padding: 20px; border-bottom: 1px solid var(--border);">
        <div style="display: flex; align-items: center; justify-content: space-between; width: 100%;">
          <div class="list__left" style="gap: 20px;">
            <div style="display: flex; gap: 8px; align-items: center;">
              <div class="score-box label-{{this.current_rating}}" style="width: 40px; height: 40px; border-radius: 8px; font-size: 14px;">
                {{this.current_score}}
              </div>
              <span class="muted" style="font-size: 18px;">â†’</span>
              <div class="score-box label-{{this.potential_rating}}" style="width: 40px; height: 40px; border-radius: 8px; font-size: 14px; opacity: 0.7;">
                {{this.potential_score}}
              </div>
            </div>
            <div style="min-width: 0;">
              <div class="list__title" style="font-size: 1.1rem;">{{this.address}}</div>
              <div class="list__meta"><span class="pill pill--blue">{{this.postcode}}</span></div>
            </div>
          </div>
          <div class="list__right">
            <button class="btn btn--sm toggle-details" style="margin-right: 8px; background: rgba(255,255,255,0.05);">View Details</button>
            <button class="btn btn--danger btn--sm delete-btn" data-id="{{this.id}}">Remove</button>
          </div>
        </div>

        <div class="fav-details" style="display: none; margin-top: 20px; border-top: 1px dashed var(--border); padding-top: 20px;">
          <div style="max-width: 300px;">
            <div class="epc-container" style="margin: 0;">
              <div class="epc-header-row">
                <div style="text-align: left; font-size: 9px;">RATING</div>
                <div style="text-align: center; font-size: 9px;">NOW</div>
                <div style="text-align: center; font-size: 9px;">POT.</div>
              </div>

              {{#each (split "A,B,C,D,E,F,G")}}
                <div class="epc-row-wrapper">
                  <div class="epc-bar bar-{{this}}">{{this}}</div>
                  
                  <div class="score-box {{#if (eq ../current_rating this)}}label-{{this}}{{/if}}">
                    {{#if (eq ../current_rating this)}} {{../current_score}} {{/if}}
                  </div>

                  <div class="score-box {{#if (eq ../potential_rating this)}}label-{{this}}{{/if}}">
                    {{#if (eq ../potential_rating this)}} {{../potential_score}} {{/if}}
                  </div>
                </div>
              {{/each}}
            </div>
          </div>
          <p class="muted" style="margin-top: 15px; font-size: 11px;">Certificate Key: {{this.lmk_key}}</p>
        </div>
      </div>
    {{/each}}
  </div>
</section>

<div id="search-results-container" style="margin-top: 2.5rem;"></div>